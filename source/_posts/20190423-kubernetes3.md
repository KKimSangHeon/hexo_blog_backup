---
title: (K8s) 3. Pods and Nodes
date: 2019-04-23 21:07:56
categories:
- CS
- MSA
tags:
- kubernetes
thumbnail: /images/K8s.png
---
#### Pods
https://kubernetes.io/ko/docs/tutorials/kubernetes-basics/explore/explore-intro/

디플로이먼트를 만들면 쿠버네티스는 파드를 만들어 어플리케이션 인스턴스를 호스트 해준다. 파드는 쿠버네티스 인스턴스이며 하나 또는 여러 컨테이너(도커나 rkt) 그룹을 추상화한것이다. 컨테이너 뿐만아니라 컨테이너들이 사용하는 리소스도 포함해서 파드라고 한다.

리소스는 다음을 포함한다.
- 볼륨과 같은, 공유 스토리지
- 클러스터 IP 주소와 같은, 네트워킹
- 컨테이너 이미지 버전 또는 사용할 특정 포트와 같이, 각 컨테이너가 동작하는 방식에 대한 정보

파드는 어플리케이션에 특화된 논리적인 호스트를 모델링한것이고 다른 어플리케이션 컨테이너를 이 안에 담아놓을 수 있으며 비교적 관련있는것들 끼리 모아놓은것이다. 예를 들어 하나의 팟안에다 두개의 컨테이너를 하나에 파드에 넣을 수 있다, 하나의 파드안에 들은 컨테이너들은 IP와 포트를 공유한다. 그래서 항상 같이 존재하며 같이 스케줄링된다.

파드는 atomic unit 이다. 쿠버네티스에서 디플로이먼트를 만들었을때 디플로이먼트는 컨테이너를 갖고있는 파드를 만든다.(컨테이너를 직접 만드는것이 아님)
각각의 파드가 특정한 노드에 묶이게 되고 그 노드안에서 살게된다. 노드가 실패하면 동일한 파드를 또다른 클러스터에 있는 다른노드에서 실행한다.
즉 파드 단위로 옮겨다닌다.

#### Node
파드를 실행하는게 노드이며 노드는 쿠버네티스에서 워커머신이다.(쿠버네티스는 마스터, 워커노드가 존재) 노드는 버츄얼 피지컬 머신일 수 도있다. 노드는 마스터에서 관리되면 여러개의 파드를 갖고있으며 쿠버네티스 마스터는 자동으로 어떤 파드를 노드에 올릴지 클러스터링 한다. 마스터의 자동 스케줄링은 가용한 리소스를 고용해서..

모든 쿠버네티스 노드는 최소한 다음을 실행한다
- Kubelet(팀장님)은, 쿠버네티스 마스터(본부장님)와 노드 간 통신을 책임지는 프로세스이며, 하나의 머신 상에서 동작하는 파드와 컨테이너를 관리한다.

- (도커, rkt)와 같은 컨테이너 런타임은 레지스트리에서 컨테이너 이미지를 가져와 묶여 있는 것을 풀고 애플리케이션을 동작시키는 책임을 맡는다.

노드 개요
노드안에 파드가 여러개 들어갈 수 있고 파드는 각 아이피를 할당받는다. Kubelet이 노드들을 관리


kubectl을 통해서 배포된 앱들의 정보를 가져올 수 있다.
kubectl get - 자원을 나열한다
kubectl describe - 자원에 대해 상세한 정보를 보여준다.
kubectl logs - 파드 내 컨테이너의 로그들을 출력한다
kubectl exec - 파드 내 컨테이너에 대한 명령을 실행한다.

언제 애플리케이션이 배포되었으며, 현재 상태가 어떠한지, 그것의 구성은 어떠한지 등을 보기 위해 이러한 명령을 이용할 수 있다.


kubectl get pods
를 입력하여 파드가 있나 확인해보고 없으면 빌드를 다시해라

kubectl describe pods
를 입력하여 파드에 대한 자세한 정보를 보자.IP, Port, Event
결과물은

kubectl describe node
를 입력하여 노드 정보를 갖고올 수 있다.

파드가 isolate, private 네트웍에서 동작하기에 kubectl proxy를 써서 사용하였었다.

kubectl proxy
를 입력하여 프록시르 띄우자

파드네임과 쿼리를 갖고와 프록시를 해보자.
```
export POD_NAME=$(kubectl get pods -o go-template --template '{{range .items}}{{.metadata.name}}{{"\n"}}{{end}}')
echo Name of the Pod: $POD_NAME
```

동작하고 있는 애플리케이션 정보를 보고싶다면
curl http://localhost:8001/api/v1/namespaces/default/pods/$POD_NAME/proxy/
를 입력하면 된다.

애플리케이션에서 보통 STDOUT로 내보내는데 그것이 로그가 된다. 이를 쿠버네티스 다음명령오로 가져올 수 있다.
kubectl logs $POD_NAME
(지금은 컨테이너가 파드안에 하나이기 때문에 지정하지 않아도 된다.)

파드가 동작하고 있으면 그안에 컨테이너에게 명령어를 실행할 수 있는데 다음과 같이 하면된다.
kubectl exec $POD_NAME env
(컨테이너 이름을 생략할수 있는것은 지금은 파드안에 컨테이너가 하나이기 때문에)

kubectl exec -ti $POD_NAME bash
를 입력하여 NodeJS 가 돌고있는 배쉬가 생겼다.
이를통해 컨테이너 안에서 명령들을 동작해볼 수 있다.
